<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Game Tài Xỉu - Mini (Có Nạp Tiền)</title>
  <style>
    :root{
      --bg:#0f1724; --card:#0b1220; --accent:#10b981; --muted:#94a3b8; --danger:#ef4444;
      --glass: rgba(255,255,255,0.03);
    }
    *{box-sizing:border-box;font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto;}
    body{margin:0; background:linear-gradient(180deg,#071029 0%, #081427 100%); color:#e6eef6; min-height:100vh; display:flex; align-items:center; justify-content:center; padding:24px;}
    .wrap{width:980px; max-width:98%; background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.015)); border-radius:12px; padding:20px; box-shadow:0 8px 30px rgba(2,6,23,0.7); display:grid; grid-template-columns: 360px 1fr; gap:18px;}
    .panel{background:var(--card); padding:16px; border-radius:10px;}
    .left .balance{font-size:28px; font-weight:700; color:var(--accent); margin-bottom:8px;}
    .small{color:var(--muted); font-size:13px;}
    .timer{font-size:42px; font-weight:800; text-align:center; padding:18px 8px; background:var(--glass); border-radius:8px; margin:12px 0;}
    .controls{display:flex; gap:8px; margin-top:12px;}
    input[type=number]{width:100%; padding:10px; border-radius:8px; border:1px solid rgba(255,255,255,0.04); background:transparent; color:inherit;}
    .btn{padding:10px 14px; border-radius:8px; cursor:pointer; border:none; font-weight:700;}
    .btn.green{background:linear-gradient(90deg,#10b981,#059669); color:#021212;}
    .btn.red{background:linear-gradient(90deg,#ef4444,#b91c1c); color:#fff;}
    .btn.ghost{background:transparent; border:1px solid rgba(255,255,255,0.15); color:var(--muted);}

    .btn.blue{background:linear-gradient(90deg,#3b82f6,#1d4ed8); color:white;}

    .dice-row{display:flex; gap:10px; justify-content:center; margin-top:10px;}
    .dice{width:70px; height:70px; border-radius:10px; background:#fff; color:#000; display:flex; align-items:center; justify-content:center; font-size:28px; font-weight:800;}
    .result{font-size:18px; margin-top:8px; text-align:center;}
    .history{max-height:200px; overflow:auto; padding-top:8px;}
    .row{display:flex; justify-content:space-between; padding:8px 0; border-bottom:1px dashed rgba(255,255,255,0.06); font-size:14px;}
    footer{text-align:center; color:var(--muted); font-size:13px;}

    /* Popup nạp tiền */
    #depositModal {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.6);
      display: none;
      align-items: center;
      justify-content: center;
    }
    #depositBox {
      background: #0f172a;
      padding: 20px;
      width: 300px;
      border-radius: 10px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.4);
      animation: fadeIn .2s ease;
    }
    @keyframes fadeIn {
      from { transform: scale(.8); opacity: 0; }
      to { transform: scale(1); opacity: 1; }
    }
  </style>
</head>
<body>

<div id="depositModal">
  <div id="depositBox">
    <h3 style="margin-top:0;">Nạp tiền</h3>
    <input id="depositAmount" type="number" min="1" placeholder="Nhập số tiền..." style="width:100%;padding:10px;border-radius:8px;margin-top:8px;">
    <div style="display:flex;gap:10px;margin-top:15px;">
      <button class="btn green" id="depositOk">Xác nhận</button>
      <button class="btn ghost" id="depositCancel">Hủy</button>
    </div>
  </div>
</div>

<div class="wrap">
  <!-- LEFT -->
  <div class="panel left">
    <div class="small">Game Tài Xỉu Demo</div>
    <div class="balance" id="balance">0</div>
    <div class="small">Số dư hiện tại (Balance)</div>

    <button class="btn blue" id="openDeposit" style="margin-top:12px;width:100%;">Nạp tiền</button>

    <div style="margin-top:18px;">
      <label class="small">Số tiền cược</label>
      <input id="betAmount" type="number" min="1" step="1" value="10" />
      <div class="controls">
        <button id="betTai" class="btn green">Đặt TÀI</button>
        <button id="betXiu" class="btn red">Đặt XỈU</button>
        <button id="clearBtn" class="btn ghost">Hủy</button>
      </div>
    </div>

    <div style="margin-top:12px;">
      <div class="small">Lịch sử</div>
      <div class="history" id="history"></div>
    </div>
  </div>

  <!-- RIGHT -->
  <div class="panel right">
    <div style="display:flex; justify-content:space-between;">
      <div>
        <div class="small">Vòng</div>
        <div id="roundNumber" style="font-size:20px;">0</div>
      </div>
      <div style="text-align:right;">
        <div class="small">Đếm ngược</div>
        <div class="timer" id="timer">30</div>
      </div>
    </div>

    <div class="dice-row">
      <div class="dice" id="d1">-</div>
      <div class="dice" id="d2">-</div>
      <div class="dice" id="d3">-</div>
    </div>

    <div class="result" id="resultText">Kết quả: —</div>
    <div class="small" id="sumText">Tổng: —</div>

    <div style="margin-top:14px;" class="row">
      <div>Cược</div>
      <div id="currentBet">Không</div>
    </div>
    <div class="row">
      <div>Tiền hàng</div>
      <div id="potential">—</div>
    </div>

  </div>

  <footer>Mỗi vòng 30 giây. Sau khi mở bát sẽ tự vào vòng tiếp theo.</footer>
</div>

<script>
  const START_BALANCE = 1000;
  let balance = START_BALANCE;
  let round = 0;
  let bet = null;
  let timer = 30;
  let timerInterval = null;
  const BET_TIME = 30;

  // DOM
  const balanceEl = document.getElementById('balance');
  const timerEl = document.getElementById('timer');
  const roundEl = document.getElementById('roundNumber');
  const betAmountInput = document.getElementById('betAmount');
  const currentBetEl = document.getElementById('currentBet');
  const potentialEl = document.getElementById('potential');
  const diceEls = [d1 = document.getElementById('d1'), d2 = document.getElementById('d2'), d3 = document.getElementById('d3')];
  const resultText = document.getElementById('resultText');
  const sumText = document.getElementById('sumText');
  const historyEl = document.getElementById('history');

  // Deposit DOM
  const modal = document.getElementById('depositModal');
  const openDeposit = document.getElementById('openDeposit');
  const depositOk = document.getElementById('depositOk');
  const depositCancel = document.getElementById('depositCancel');
  const depositAmount = document.getElementById('depositAmount');

  openDeposit.onclick = () => {
    modal.style.display = "flex";
    depositAmount.value = "";
  };

  depositCancel.onclick = () => {
    modal.style.display = "none";
  };

  depositOk.onclick = () => {
    let amt = parseInt(depositAmount.value);
    if (!amt || amt <= 0) {
      alert("Nhập số tiền hợp lệ!");
      return;
    }
    balance += amt;
    modal.style.display = "none";
    refreshUI();
  };

  // -------------------
  function refreshUI() {
    balanceEl.textContent = balance.toLocaleString();
    roundEl.textContent = round;
    timerEl.textContent = timer;
    currentBetEl.textContent = bet ? `${bet.type} — ${bet.amount}` : "Không";
    potentialEl.textContent = bet ? (bet.amount * 2).toLocaleString() : "—";
  }

  function placeBet(type) {
    const amt = parseInt(betAmountInput.value);
    if (!amt || amt <= 0) return alert("Tiền cược không hợp lệ");
    if (amt > balance) return alert("Không đủ tiền!");
    if (timer <= 0) return alert("Đã hết thời gian cược!");

    bet = { type, amount: amt };
    refreshUI();
  }

  document.getElementById('betTai').onclick = () => placeBet("TAI");
  document.getElementById('betXiu').onclick = () => placeBet("XIU");
  document.getElementById('clearBtn').onclick = () => { bet = null; refreshUI(); };

  // --- Dice logic ---
  function rand(a,b){ return Math.floor(Math.random()*(b-a+1))+a; }
  function rollDice(){ return [rand(1,6), rand(1,6), rand(1,6)]; }

  function evaluate(d){
    const sum = d[0] + d[1] + d[2];
    const triple = (d[0]===d[1] && d[1]===d[2]);
    if (triple) return { type:"HOUSE", sum, triple:true };
    if (sum >= 11) return { type:"TAI", sum, triple:false };
    return { type:"XIU", sum, triple:false };
  }

  function animateDice(finalDice, done){
    let i=0;
    const ani = setInterval(()=>{
      diceEls.forEach(x => x.textContent = rand(1,6));
      if(++i >= 12){
        clearInterval(ani);
        for(let j=0;j<3;j++) diceEls[j].textContent = finalDice[j];
        done();
      }
    },90);
  }

  function pushHistory(h){
    const row = document.createElement('div');
    row.className = "row";
    row.innerHTML = `<div>V${h.round}: ${h.outcome} (${h.sum})</div><div>${h.bet}</div>`;
    historyEl.prepend(row);
  }

  function revealRound(){
    const finalDice = rollDice();
    animateDice(finalDice, ()=>{
      const eva = evaluate(finalDice);
      resultText.textContent = eva.triple ? "Triple (Nhà cái thắng)" : `Kết quả: ${eva.type}`;
      sumText.textContent = "Tổng: " + eva.sum;

      let recordBet = "-";

      if (bet){
        if (eva.triple || bet.type !== eva.type){
          balance -= bet.amount;
          recordBet = `${bet.type} ${bet.amount} → Thua`;
        } else {
          balance += bet.amount;
          recordBet = `${bet.type} ${bet.amount} → Thắng`;
        }
      }

      pushHistory({ round, outcome: eva.triple ? "HOUSE" : eva.type, sum: eva.sum, bet: recordBet });
      bet = null;
      refreshUI();
      setTimeout(startRound, 2500);
    });
  }

  function startRound(){
    round++;
    timer = BET_TIME;
    resultText.textContent = "Đang đặt cược...";
    sumText.textContent = "Tổng: —";
    diceEls.forEach(d => d.textContent = "-");
    refreshUI();

    if (timerInterval) clearInterval(timerInterval);
    timerInterval = setInterval(()=>{
      timer--;
      if (timer < 0){
        clearInterval(timerInterval);
        revealRound();
      } else {
        timerEl.textContent = timer;
      }
    },1000);
  }

  function init(){
    balance = START_BALANCE;
    refreshUI();
    setTimeout(startRound, 800);
  }
  init();
</script>

</body>
</html>
