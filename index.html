<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Game Tài Xỉu - Mini</title>
<style>
:root{
  --bg:#0f1724; --card:#0b1220; --accent:#10b981; --muted:#94a3b8; --danger:#ef4444;
  --glass: rgba(255,255,255,0.03);
}
*{box-sizing:border-box;font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto;}
body{margin:0; background:linear-gradient(180deg,#071029 0%, #081427 100%); color:#e6eef6; min-height:100vh; display:flex; align-items:center; justify-content:center; padding:12px;}
.wrap{
  width:980px; max-width:98%; background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.015)); border-radius:12px; padding:16px;
  box-shadow:0 8px 30px rgba(2,6,23,0.7); display:grid; grid-template-columns:360px 1fr; gap:12px;
}
.panel{background:var(--card); padding:16px; border-radius:10px;}
.left .balance{font-size:24px; font-weight:700; color:var(--accent); margin-bottom:6px;}
.small{color:var(--muted); font-size:13px;}
.timer{font-size:36px; font-weight:800; text-align:center; padding:16px 6px; background:var(--glass); border-radius:8px; margin:10px 0;}
.controls{display:flex; gap:6px; margin-top:10px; flex-wrap:wrap;}
.btn{padding:10px 12px; border-radius:8px; cursor:pointer; border:none; font-weight:700; flex:1; text-align:center;}
.btn.green{background:linear-gradient(90deg,#10b981,#059669); color:#021212;}
.btn.red{background:linear-gradient(90deg,#ef4444,#b91c1c); color:#fff;}
.btn.ghost{background:transparent; border:1px solid rgba(255,255,255,0.15); color:var(--muted);}
.btn.blue{background:linear-gradient(90deg,#3b82f6,#1d4ed8); color:white;}
.dice-row{display:flex; gap:8px; justify-content:center; margin-top:8px; flex-wrap:wrap;}
.dice{width:60px; height:60px; border-radius:10px; background:#fff; color:#000; display:flex; align-items:center; justify-content:center; font-size:24px; font-weight:800;}
.result{font-size:16px; margin-top:6px; text-align:center;}
.history{max-height:160px; overflow:auto; padding-top:6px;}
.row{display:flex; justify-content:space-between; padding:6px 0; border-bottom:1px dashed rgba(255,255,255,0.06); font-size:13px;}
footer{text-align:center; color:var(--muted); font-size:12px;}

/* Deposit popup */
#depositModal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.6);display:none;align-items:center;justify-content:center;}
#depositBox{background:#0f172a;padding:16px;width:280px;border-radius:10px;box-shadow:0 10px 30px rgba(0,0,0,0.4);}
#depositBox input{width:100%;padding:8px;border-radius:6px;margin-top:6px;border:none;outline:none;}

@media(max-width:900px){
  .wrap{grid-template-columns:1fr;}
  .dice{width:50px; height:50px; font-size:20px;}
  .timer{font-size:28px;}
  .balance{font-size:20px;}
  .controls .btn{flex:1 1 48%;}
}
@media(max-width:500px){
  .dice{width:40px; height:40px; font-size:18px;}
  .timer{font-size:24px;}
  .balance{font-size:18px;}
  .controls{flex-direction:column;}
  .controls .btn{width:100%;}
}
</style>
</head>
<body>

<div id="depositModal">
  <div id="depositBox">
    <h3 style="margin-top:0;">Nạp tiền</h3>
    <input id="depositAmount" type="number" min="1" placeholder="Nhập số tiền...">
    <div style="display:flex; gap:6px; margin-top:10px;">
      <button class="btn green" id="depositOk">Xác nhận</button>
      <button class="btn ghost" id="depositCancel">Hủy</button>
    </div>
  </div>
</div>

<div class="wrap">
  <!-- LEFT -->
  <div class="panel left">
    <div class="small">Game Tài Xỉu Mobile</div>
    <div class="balance" id="balance">0</div>
    <div class="small">Số dư hiện tại</div>

    <button class="btn blue" id="openDeposit" style="margin-top:8px;width:100%;">Nạp tiền</button>

    <div style="margin-top:10px;">
      <label class="small">Chọn tiền cược</label>
      <div class="controls">
        <button class="btn ghost betPreset" data-amount="5000">5.000</button>
        <button class="btn ghost betPreset" data-amount="10000">10.000</button>
        <button class="btn ghost betPreset" data-amount="20000">20.000</button>
        <button class="btn ghost betPreset" data-amount="50000">50.000</button>
      </div>
      <div style="margin-top:6px;">
        <span class="small">Tổng cược: </span><span id="currentBetAmount">0</span>
      </div>
      <div class="controls" style="margin-top:6px;">
        <button id="betTai" class="btn green">Đặt TÀI</button>
        <button id="betXiu" class="btn red">Đặt XỈU</button>
        <button id="clearBtn" class="btn ghost">Hủy</button>
      </div>
    </div>

    <div style="margin-top:10px;">
      <div class="small">Lịch sử</div>
      <div class="history" id="history"></div>
    </div>
  </div>

  <!-- RIGHT -->
  <div class="panel right">
    <div style="display:flex; justify-content:space-between;">
      <div>
        <div class="small">Vòng</div>
        <div id="roundNumber" style="font-size:18px;">0</div>
      </div>
      <div style="text-align:right;">
        <div class="small">Đếm ngược</div>
        <div class="timer" id="timer">30</div>
      </div>
    </div>

    <div class="dice-row">
      <div class="dice" id="d1">-</div>
      <div class="dice" id="d2">-</div>
      <div class="dice" id="d3">-</div>
    </div>

    <div class="result" id="resultText">Kết quả: —</div>
    <div class="small" id="sumText">Tổng: —</div>

    <div style="margin-top:8px;" class="row">
      <div>Cược</div>
      <div id="currentBet">Không</div>
    </div>
    <div class="row">
      <div>Tiền hàng</div>
      <div id="potential">—</div>
    </div>
  </div>
</div>

<script>
let balance=0, round=0, bet=null, timer=30, timerInterval=null, pendingBetAmount=0;
const BET_TIME=15;

const balanceEl=document.getElementById('balance');
const timerEl=document.getElementById('timer');
const roundEl=document.getElementById('roundNumber');
const currentBetEl=document.getElementById('currentBet');
const potentialEl=document.getElementById('potential');
const diceEls=[d1=document.getElementById('d1'), d2=document.getElementById('d2'), d3=document.getElementById('d3')];
const resultText=document.getElementById('resultText');
const sumText=document.getElementById('sumText');
const historyEl=document.getElementById('history');
const currentBetAmountEl=document.getElementById('currentBetAmount');

// Deposit
const modal=document.getElementById('depositModal');
const openDeposit=document.getElementById('openDeposit');
const depositOk=document.getElementById('depositOk');
const depositCancel=document.getElementById('depositCancel');
const depositAmount=document.getElementById('depositAmount');

openDeposit.onclick=()=>{ modal.style.display="flex"; depositAmount.value=""; }
depositCancel.onclick=()=>{ modal.style.display="none"; }
depositOk.onclick=()=>{
  let amt=parseInt(depositAmount.value);
  if(!amt || amt<=0){ alert("Nhập số tiền hợp lệ!"); return; }
  balance+=amt;
  modal.style.display="none";
  refreshUI();
}

// Chọn preset
document.querySelectorAll('.betPreset').forEach(btn=>{
  btn.onclick=()=>{ pendingBetAmount+=parseInt(btn.dataset.amount); currentBetAmountEl.textContent=pendingBetAmount.toLocaleString(); }
});
document.getElementById('clearBtn').onclick=()=>{ pendingBetAmount=0; currentBetAmountEl.textContent=0; }

function refreshUI(){
  balanceEl.textContent=balance.toLocaleString();
  roundEl.textContent=round;
  timerEl.textContent=timer;
  currentBetEl.textContent=bet ? `${bet.type} — ${bet.amount}` : "Không";
  potentialEl.textContent=bet ? (bet.amount*1.95).toLocaleString() : "—";
}

function placeBet(type){
  if(pendingBetAmount<=0){ alert("Chưa chọn tiền cược!"); return; }
  if(pendingBetAmount>balance){ alert("Không đủ tiền!"); return; }
  bet={type, amount:pendingBetAmount};
  pendingBetAmount=0;
  currentBetAmountEl.textContent=0;
  refreshUI();
}

document.getElementById('betTai').onclick=()=>placeBet("TAI");
document.getElementById('betXiu').onclick=()=>placeBet("XIU");

// Dice logic
function rand(a,b){ return Math.floor(Math.random()*(b-a+1))+a; }
function rollDice(){ return [rand(1,6), rand(1,6), rand(1,6)]; }
function evaluate(d){
  const sum=d[0]+d[1]+d[2];
  const triple=(d[0]===d[1]&&d[1]===d[2]);
  if(triple) return {type:"HOUSE",sum,triple:true};
  if(sum>=11) return {type:"TAI",sum,triple:false};
  return {type:"XIU",sum,triple:false};
}
function animateDice(finalDice,done){
  let i=0;
  const ani=setInterval(()=>{
    diceEls.forEach(x=>x.textContent=rand(1,6));
    if(++i>=12){ clearInterval(ani); for(let j=0;j<3;j++) diceEls[j].textContent=finalDice[j]; done(); }
  },80);
}
function pushHistory(h){
  const row=document.createElement('div');
  row.className="row";
  row.innerHTML=`<div>V${h.round}: ${h.outcome} (${h.sum})</div><div>${h.bet}</div>`;
  historyEl.prepend(row);
}
function revealRound(){
  const finalDice=rollDice();
  animateDice(finalDice,()=>{
    const eva=evaluate(finalDice);
    resultText.textContent=eva.triple?"Triple (Nhà cái thắng)":`Kết quả: ${eva.type}`;
    sumText.textContent="Tổng: "+eva.sum;
    let recordBet="-";
    if(bet){
      if(eva.triple||bet.type!==eva.type){ balance-=bet.amount; recordBet=`${bet.type} ${bet.amount} → Thua`; }
      else{ balance+=bet.amount; recordBet=`${bet.type} ${bet.amount} → Thắng`; }
    }
    pushHistory({round,outcome:eva.triple?"HOUSE":eva.type,sum:eva.sum,bet:recordBet});
    bet=null; refreshUI();
    setTimeout(startRound,2000);
  });
}
function startRound(){
  round++;
  timer=BET_TIME;
  resultText.textContent="Đang đặt cược...";
  sumText.textContent="Tổng: —";
  diceEls.forEach(d=>d.textContent="-");
  refreshUI();
  if(timerInterval) clearInterval(timerInterval);
  timerInterval=setInterval(()=>{
    timer--;
    if(timer<0){ clearInterval(timerInterval); revealRound(); } else { timerEl.textContent=timer; }
  },1000);
}
function init(){ balance=0; refreshUI(); setTimeout(startRound,500); }
init();
</script>

</body>
</html>
